<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Corre√ß√µes - Home</title>
    <!-- TikTok Pixel Code Start -->
<script>
!function (w, d, t) {
  w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(
var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script")
;n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};

  ttq.load('D1QFD0RC77UF6MBM48MG');
}(window, document, 'ttq');
</script>
<!-- TikTok Pixel Code End -->
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 8px;
            background: #242424;
        }
        button {
            background: #d4af37;
            color: #1a1a1a;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        button:hover { background: #c19b26; }
        .results {
            margin-top: 10px;
            padding: 10px;
            background: #333;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .error { color: #ff6b6b; }
        .success { color: #4ecdc4; }
        .warning { color: #ffe66d; }
        .info { color: #a8e6cf; }
        .hero__content, .counter, #como-funciona, #precos {
            padding: 20px;
            margin: 10px 0;
            background: #333;
            border-radius: 8px;
            min-height: 100px;
        }
    </style>
</head>
<body>
    <h1>üîß Teste de Corre√ß√µes - P√°gina Home</h1>
    <p>Esta p√°gina testa se todas as corre√ß√µes dos erros da home est√£o funcionando.</p>

    <div class="test-section">
        <h2>üìã Status dos Sistemas</h2>
        <button onclick="checkSystemStatus()">Verificar Status Geral</button>
        <div id="status-results" class="results"></div>
    </div>

    <div class="test-section">
        <h2>üè† Teste M√©todos da Home</h2>
        <button onclick="testHomeViewHero()">Testar viewHero</button>
        <button onclick="testHomeViewHowItWorks()">Testar viewHowItWorks</button>
        <button onclick="testHomeViewPricing()">Testar viewPricing</button>
        <button onclick="testTrackSectionView()">Testar trackSectionView</button>
        <div id="home-results" class="results"></div>
    </div>

    <div class="test-section">
        <h2>üëÅÔ∏è Teste IntersectionObserver (Simula√ß√£o)</h2>
        <div class="hero__content">Se√ß√£o Hero (simulada)</div>
        <div class="counter" data-counter="1000">Contador (simulado)</div>
        <div id="como-funciona">Como Funciona (simulado)</div>
        <div id="precos">Pre√ßos (simulado)</div>
        <button onclick="testIntersectionObserver()">Testar Observer</button>
        <div id="observer-results" class="results"></div>
    </div>

    <div class="test-section">
        <h2>üåê Teste API Backend</h2>
        <button onclick="testBackendAPI()">Testar API TikTok Backend</button>
        <div id="api-results" class="results"></div>
    </div>

    <div class="test-section">
        <h2>üìÑ Teste Web Manifest</h2>
        <button onclick="testWebManifest()">Verificar site.webmanifest</button>
        <div id="manifest-results" class="results"></div>
    </div>

    <script src="js/tiktok-events-v3.js"></script>
    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info';
            element.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            element.scrollTop = element.scrollHeight;
        }

        function checkSystemStatus() {
            const results = document.getElementById('status-results');
            results.innerHTML = '';
            
            log('status-results', 'üîç Verificando status dos sistemas...');
            
            // Verificar TikTok Pixel
            if (typeof ttq !== 'undefined') {
                log('status-results', '‚úÖ TikTok Pixel carregado com sucesso', 'success');
            } else {
                log('status-results', '‚ùå TikTok Pixel n√£o encontrado', 'error');
            }
            
            // Verificar TikTokManager
            if (typeof window.TikTokManager !== 'undefined') {
                log('status-results', '‚úÖ TikTokManager dispon√≠vel', 'success');
            } else {
                log('status-results', '‚ùå TikTokManager n√£o encontrado', 'error');
            }
            
            // Verificar TikTokEvents
            if (typeof window.TikTokEvents !== 'undefined') {
                log('status-results', '‚úÖ TikTokEvents dispon√≠vel', 'success');
                
                // Verificar m√©todos espec√≠ficos da home
                if (window.TikTokEvents.home) {
                    log('status-results', '‚úÖ TikTokEvents.home dispon√≠vel', 'success');
                    
                    const methods = ['viewHero', 'viewHowItWorks', 'viewPricing'];
                    methods.forEach(method => {
                        if (typeof window.TikTokEvents.home[method] === 'function') {
                            log('status-results', `‚úÖ TikTokEvents.home.${method} dispon√≠vel`, 'success');
                        } else {
                            log('status-results', `‚ùå TikTokEvents.home.${method} n√£o encontrado`, 'error');
                        }
                    });
                } else {
                    log('status-results', '‚ùå TikTokEvents.home n√£o encontrado', 'error');
                }
                
                if (typeof window.TikTokEvents.trackSectionView === 'function') {
                    log('status-results', '‚úÖ TikTokEvents.trackSectionView dispon√≠vel', 'success');
                } else {
                    log('status-results', '‚ùå TikTokEvents.trackSectionView n√£o encontrado', 'error');
                }
            } else {
                log('status-results', '‚ùå TikTokEvents n√£o encontrado', 'error');
            }
        }

        async function testHomeViewHero() {
            const results = document.getElementById('home-results');
            log('home-results', 'üè† Testando TikTokEvents.home.viewHero()...');
            
            try {
                if (window.TikTokEvents && window.TikTokEvents.home && window.TikTokEvents.home.viewHero) {
                    const result = await window.TikTokEvents.home.viewHero();
                    log('home-results', `‚úÖ viewHero executado: ${JSON.stringify(result)}`, 'success');
                } else {
                    log('home-results', '‚ùå TikTokEvents.home.viewHero n√£o est√° dispon√≠vel', 'error');
                }
            } catch (error) {
                log('home-results', `‚ùå Erro ao executar viewHero: ${error.message}`, 'error');
            }
        }

        async function testHomeViewHowItWorks() {
            log('home-results', '‚ùì Testando TikTokEvents.home.viewHowItWorks()...');
            
            try {
                if (window.TikTokEvents && window.TikTokEvents.home && window.TikTokEvents.home.viewHowItWorks) {
                    const result = await window.TikTokEvents.home.viewHowItWorks();
                    log('home-results', `‚úÖ viewHowItWorks executado: ${JSON.stringify(result)}`, 'success');
                } else {
                    log('home-results', '‚ùå TikTokEvents.home.viewHowItWorks n√£o est√° dispon√≠vel', 'error');
                }
            } catch (error) {
                log('home-results', `‚ùå Erro ao executar viewHowItWorks: ${error.message}`, 'error');
            }
        }

        async function testHomeViewPricing() {
            log('home-results', 'üí∞ Testando TikTokEvents.home.viewPricing()...');
            
            try {
                if (window.TikTokEvents && window.TikTokEvents.home && window.TikTokEvents.home.viewPricing) {
                    const result = await window.TikTokEvents.home.viewPricing();
                    log('home-results', `‚úÖ viewPricing executado: ${JSON.stringify(result)}`, 'success');
                } else {
                    log('home-results', '‚ùå TikTokEvents.home.viewPricing n√£o est√° dispon√≠vel', 'error');
                }
            } catch (error) {
                log('home-results', `‚ùå Erro ao executar viewPricing: ${error.message}`, 'error');
            }
        }

        async function testTrackSectionView() {
            log('home-results', 'üìä Testando TikTokEvents.trackSectionView()...');
            
            try {
                if (window.TikTokEvents && window.TikTokEvents.trackSectionView) {
                    const result = await window.TikTokEvents.trackSectionView('test_section', 'Se√ß√£o de Teste', 7);
                    log('home-results', `‚úÖ trackSectionView executado: ${JSON.stringify(result)}`, 'success');
                } else {
                    log('home-results', '‚ùå TikTokEvents.trackSectionView n√£o est√° dispon√≠vel', 'error');
                }
            } catch (error) {
                log('home-results', `‚ùå Erro ao executar trackSectionView: ${error.message}`, 'error');
            }
        }

        function testIntersectionObserver() {
            const results = document.getElementById('observer-results');
            results.innerHTML = '';
            log('observer-results', 'üëÅÔ∏è Simulando IntersectionObserver...');
            
            // Simular o c√≥digo do home.js original
            const entries = [
                { isIntersecting: true, target: { classList: { contains: (cls) => cls === 'hero__content', add: () => {} } } },
                { isIntersecting: true, target: { classList: { contains: (cls) => cls === 'counter', add: () => {} } } },
                { isIntersecting: true, target: { closest: (sel) => sel === '#como-funciona' ? true : false, classList: { add: () => {} } } },
                { isIntersecting: true, target: { closest: (sel) => sel === '#precos' ? true : false, classList: { add: () => {} } } }
            ];

            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                    
                    // Reproduzir a l√≥gica do home.js
                    if (typeof TikTokEvents !== 'undefined') {
                        try {
                            if (entry.target.classList.contains('counter')) {
                                log('observer-results', 'üìä Se√ß√£o contador detectada', 'info');
                                TikTokEvents.trackSectionView('counter', 'Contador de Cart√µes');
                                log('observer-results', '‚úÖ trackSectionView(counter) executado', 'success');
                            } else if (entry.target.classList.contains('hero__content')) {
                                log('observer-results', 'üè† Se√ß√£o hero detectada', 'info');
                                TikTokEvents.home.viewHero();
                                log('observer-results', '‚úÖ home.viewHero() executado', 'success');
                            } else if (entry.target.closest('#como-funciona')) {
                                log('observer-results', '‚ùì Se√ß√£o como-funciona detectada', 'info');
                                TikTokEvents.home.viewHowItWorks();
                                log('observer-results', '‚úÖ home.viewHowItWorks() executado', 'success');
                            } else if (entry.target.closest('#precos')) {
                                log('observer-results', 'üí∞ Se√ß√£o pre√ßos detectada', 'info');
                                TikTokEvents.home.viewPricing();
                                log('observer-results', '‚úÖ home.viewPricing() executado', 'success');
                            }
                        } catch (error) {
                            log('observer-results', `‚ùå Erro no observer: ${error.message}`, 'error');
                        }
                    }
                }
            });
        }

        async function testBackendAPI() {
            const results = document.getElementById('api-results');
            results.innerHTML = '';
            log('api-results', 'üåê Testando API do backend...');
            
            const testEvent = {
                eventName: 'ViewContent',
                eventData: {
                    content_id: 'test_api_call',
                    content_name: 'Teste API Backend',
                    value: 5,
                    currency: 'BRL',
                    content_type: 'website'
                },
                userData: {
                    email: 'test@example.com'
                },
                eventId: 'test_' + Date.now()
            };
            
            try {
                const response = await fetch('/api/tiktok/track-event', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testEvent)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    log('api-results', `‚úÖ API resposta (${response.status}): ${JSON.stringify(result, null, 2)}`, 'success');
                } else {
                    log('api-results', `‚ö†Ô∏è API erro (${response.status}): ${JSON.stringify(result, null, 2)}`, 'warning');
                }
            } catch (error) {
                log('api-results', `‚ùå Erro de rede: ${error.message}`, 'error');
            }
        }

        async function testWebManifest() {
            const results = document.getElementById('manifest-results');
            results.innerHTML = '';
            log('manifest-results', 'üìÑ Testando site.webmanifest...');
            
            try {
                const response = await fetch('/site.webmanifest');
                const text = await response.text();
                
                if (response.ok) {
                    try {
                        const manifest = JSON.parse(text);
                        log('manifest-results', `‚úÖ Manifest carregado (${response.status}):\n${JSON.stringify(manifest, null, 2)}`, 'success');
                    } catch (parseError) {
                        log('manifest-results', `‚ùå Manifest inv√°lido: ${parseError.message}\nConte√∫do: ${text}`, 'error');
                    }
                } else {
                    log('manifest-results', `‚ùå Erro ao carregar manifest (${response.status}): ${text}`, 'error');
                }
            } catch (error) {
                log('manifest-results', `‚ùå Erro de rede: ${error.message}`, 'error');
            }
        }

        // Verificar status automaticamente ao carregar
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(checkSystemStatus, 1000);
        });
    </script>
</body>
</html>
