<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Corre√ß√£o Content Type - TikTok Events</title>
    <!-- TikTok Pixel Code Start -->
<script>
!function (w, d, t) {
  w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(
var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script")
;n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};

  ttq.load('D1QFD0RC77UF6MBM48MG');
}(window, document, 'ttq');
</script>
<!-- TikTok Pixel Code End -->
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #4a90e2;
            margin-top: 0;
        }
        button {
            background: #4a90e2;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
        }
        button:hover {
            background: #357abd;
        }
        .results {
            background: #f8f9fa;
            padding: 15px;
            margin-top: 15px;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            color: #dc3545;
        }
        .success {
            color: #28a745;
        }
        .warning {
            color: #ffc107;
        }
        .info {
            color: #17a2b8;
        }
        .event-interceptor {
            background: #e3f2fd;
            padding: 15px;
            border-left: 4px solid #2196f3;
            margin-bottom: 20px;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .comparison-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .old-value {
            background: #ffebee;
            color: #d32f2f;
        }
        .new-value {
            background: #e8f5e8;
            color: #2e7d32;
        }
    </style>
</head>
<body>
    <h1>üîß Teste de Corre√ß√£o Content Type - TikTok Events</h1>
    <p style="text-align: center; color: #666;">
        Esta p√°gina testa se as corre√ß√µes de <code>content_type</code> foram aplicadas corretamente nos eventos ViewContent.
    </p>

    <!-- Intercepta√ß√£o de Eventos -->
    <div class="event-interceptor">
        <h3>üì° Intercepta√ß√£o de Eventos</h3>
        <p>Todos os eventos TikTok enviados ser√£o interceptados e exibidos aqui para an√°lise.</p>
        <div id="event-log"></div>
    </div>

    <!-- Teste de Valores Antigos vs Novos -->
    <div class="test-section">
        <h2>üîÑ Compara√ß√£o: Valores Antigos vs Corretos</h2>
        <p>Compare os valores de <code>content_type</code> antes e depois da corre√ß√£o:</p>
        
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>P√°gina/Contexto</th>
                    <th class="old-value">‚ùå Valor Antigo (Inv√°lido)</th>
                    <th class="new-value">‚úÖ Valor Novo (V√°lido)</th>
                    <th>Descri√ß√£o</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>P√°gina Create - Etapas</td>
                    <td class="old-value">creation_step</td>
                    <td class="new-value">product</td>
                    <td>Ferramenta de cria√ß√£o como produto</td>
                </tr>
                <tr>
                    <td>P√°gina Create - Geral</td>
                    <td class="old-value">creation_tool</td>
                    <td class="new-value">product</td>
                    <td>Ferramenta de cria√ß√£o como produto</td>
                </tr>
                <tr>
                    <td>Preview de Cart√£o</td>
                    <td class="old-value">card_preview</td>
                    <td class="new-value">product</td>
                    <td>Preview como produto digital</td>
                </tr>
                <tr>
                    <td>Templates</td>
                    <td class="old-value">design_template</td>
                    <td class="new-value">product</td>
                    <td>Template como produto</td>
                </tr>
                <tr>
                    <td>Conte√∫do de Cria√ß√£o</td>
                    <td class="old-value">creation_[tipo]</td>
                    <td class="new-value">product</td>
                    <td>Conte√∫do de cria√ß√£o como produto</td>
                </tr>
                <tr>
                    <td>P√°gina View</td>
                    <td class="old-value">digital_card</td>
                    <td class="new-value">product</td>
                    <td>Cart√£o digital como produto</td>
                </tr>
                <tr>
                    <td>P√°gina Home</td>
                    <td class="old-value">marketing_content</td>
                    <td class="new-value">website</td>
                    <td>P√°gina inicial como website</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Testes de Eventos Create -->
    <div class="test-section">
        <h2>üé® Testes de Eventos Create Corrigidos</h2>
        <p>Teste os m√©todos ViewContent espec√≠ficos da p√°gina create com os novos valores v√°lidos:</p>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
            <button onclick="testCreateStep()">üìù Teste Create Step</button>
            <button onclick="testCreatePreview()">üëÄ Teste Create Preview</button>
            <button onclick="testCreateTemplate()">üé® Teste Create Template</button>
            <button onclick="testCreateContent()">üéØ Teste Create Content</button>
            <button onclick="testGeneralViewContent()">üìÑ Teste ViewContent Geral</button>
        </div>
        
        <div id="test-results" class="results"></div>
    </div>

    <!-- Simula√ß√£o de Contextos -->
    <div class="test-section">
        <h2>üåê Simula√ß√£o de Contextos de P√°gina</h2>
        <p>Simule o comportamento em diferentes p√°ginas:</p>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
            <button onclick="simulateCreatePage()">üé® Simular /create</button>
            <button onclick="simulateViewPage()">üëÅÔ∏è Simular /view</button>
            <button onclick="simulateHomePage()">üè† Simular home</button>
            <button onclick="simulateOtherPage()">üìÑ Simular outra p√°gina</button>
        </div>
        
        <div id="context-results" class="results"></div>
    </div>

    <!-- Valida√ß√£o de API -->
    <div class="test-section">
        <h2>‚úÖ Valida√ß√£o de Conformidade</h2>
        <p>Verifica se todos os eventos est√£o usando valores v√°lidos aceitos pelo TikTok:</p>
        
        <button onclick="validateAllEvents()">üîç Validar Todos os Eventos</button>
        <button onclick="showValidValues()">üìã Mostrar Valores V√°lidos</button>
        
        <div id="validation-results" class="results"></div>
    </div>

    <script src="js/tiktok-events-v3.js"></script>
    <script>
        // Interceptar eventos TikTok para an√°lise
        const eventLog = document.getElementById('event-log');
        const originalTtqTrack = window.ttq ? window.ttq.track : null;
        let interceptedEvents = [];

        // Interceptar ttq.track
        if (window.ttq) {
            window.ttq.track = function(eventName, eventData) {
                const timestamp = new Date().toISOString();
                const logEntry = {
                    timestamp,
                    eventName,
                    eventData: JSON.parse(JSON.stringify(eventData))
                };
                
                interceptedEvents.push(logEntry);
                updateEventLog();
                
                // Chamar o m√©todo original
                if (originalTtqTrack) {
                    return originalTtqTrack.call(this, eventName, eventData);
                }
            };
        }

        function updateEventLog() {
            const last5Events = interceptedEvents.slice(-5);
            eventLog.innerHTML = last5Events.map(event => {
                const contentType = event.eventData.content_type || 'N/A';
                const isValid = isValidContentType(contentType);
                const statusClass = isValid ? 'success' : 'error';
                
                return `
                    <div style="margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <strong>${event.eventName}</strong> - ${event.timestamp}
                        <br><span class="${statusClass}">content_type: ${contentType} ${isValid ? '‚úÖ' : '‚ùå'}</span>
                        <br><small>content_id: ${event.eventData.content_id || 'N/A'}</small>
                        <br><small>value: ${event.eventData.value || 'N/A'} ${event.eventData.currency || ''}</small>
                    </div>
                `;
            }).join('') || '<p style="color: #999;">Nenhum evento interceptado ainda...</p>';
        }

        function isValidContentType(contentType) {
            const validTypes = ['product', 'product_group', 'website', 'article', 'landing_page'];
            return validTypes.includes(contentType);
        }

        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info';
            element.innerHTML += `<span class="${colorClass}">[${timestamp}] ${message}</span>\n`;
            element.scrollTop = element.scrollHeight;
        }

        // Testes de eventos espec√≠ficos
        function testCreateStep() {
            if (typeof TikTokEvents !== 'undefined' && TikTokEvents.viewCreateStep) {
                TikTokEvents.viewCreateStep(1, 'Sele√ß√£o de Vers√≠culo');
                log('test-results', 'viewCreateStep executado - verifique o content_type no log acima', 'success');
            } else {
                log('test-results', 'TikTokEvents.viewCreateStep n√£o encontrado', 'error');
            }
        }

        function testCreatePreview() {
            if (typeof TikTokEvents !== 'undefined' && TikTokEvents.viewCreatePreview) {
                TikTokEvents.viewCreatePreview('card_123');
                log('test-results', 'viewCreatePreview executado - verifique o content_type no log acima', 'success');
            } else {
                log('test-results', 'TikTokEvents.viewCreatePreview n√£o encontrado', 'error');
            }
        }

        function testCreateTemplate() {
            if (typeof TikTokEvents !== 'undefined' && TikTokEvents.viewCreateTemplate) {
                TikTokEvents.viewCreateTemplate('template_1', 'Template Elegante');
                log('test-results', 'viewCreateTemplate executado - verifique o content_type no log acima', 'success');
            } else {
                log('test-results', 'TikTokEvents.viewCreateTemplate n√£o encontrado', 'error');
            }
        }

        function testCreateContent() {
            if (typeof TikTokEvents !== 'undefined' && TikTokEvents.viewCreateContent) {
                TikTokEvents.viewCreateContent('verse_selection', 'Escolha do vers√≠culo');
                log('test-results', 'viewCreateContent executado - verifique o content_type no log acima', 'success');
            } else {
                log('test-results', 'TikTokEvents.viewCreateContent n√£o encontrado', 'error');
            }
        }

        function testGeneralViewContent() {
            if (typeof TikTokManager !== 'undefined' && TikTokManager.trackViewContent) {
                TikTokManager.trackViewContent('test_content', 'Conte√∫do de Teste', 10, 'BRL');
                log('test-results', 'trackViewContent geral executado - verifique o content_type no log acima', 'success');
            } else {
                log('test-results', 'TikTokManager.trackViewContent n√£o encontrado', 'error');
            }
        }

        // Simula√ß√£o de contextos
        function simulateCreatePage() {
            // Simular mudan√ßa de URL
            const originalPath = window.location.pathname;
            history.pushState({}, '', '/create');
            
            if (typeof TikTokManager !== 'undefined') {
                const context = TikTokManager.detectPageContext();
                log('context-results', `Contexto /create:\n${JSON.stringify(context, null, 2)}`, 'info');
            }
            
            // Restaurar URL
            history.pushState({}, '', originalPath);
        }

        function simulateViewPage() {
            const originalPath = window.location.pathname;
            history.pushState({}, '', '/view/123');
            
            if (typeof TikTokManager !== 'undefined') {
                const context = TikTokManager.detectPageContext();
                log('context-results', `Contexto /view:\n${JSON.stringify(context, null, 2)}`, 'info');
            }
            
            history.pushState({}, '', originalPath);
        }

        function simulateHomePage() {
            const originalPath = window.location.pathname;
            history.pushState({}, '', '/');
            
            if (typeof TikTokManager !== 'undefined') {
                const context = TikTokManager.detectPageContext();
                log('context-results', `Contexto home:\n${JSON.stringify(context, null, 2)}`, 'info');
            }
            
            history.pushState({}, '', originalPath);
        }

        function simulateOtherPage() {
            const originalPath = window.location.pathname;
            history.pushState({}, '', '/about');
            
            if (typeof TikTokManager !== 'undefined') {
                const context = TikTokManager.detectPageContext();
                log('context-results', `Contexto outra p√°gina:\n${JSON.stringify(context, null, 2)}`, 'info');
            }
            
            history.pushState({}, '', originalPath);
        }

        // Valida√ß√£o
        function validateAllEvents() {
            const results = document.getElementById('validation-results');
            results.innerHTML = 'Validando eventos interceptados...\n';
            
            if (interceptedEvents.length === 0) {
                log('validation-results', 'Nenhum evento para validar. Execute alguns testes primeiro.', 'warning');
                return;
            }
            
            let validCount = 0;
            let invalidCount = 0;
            
            interceptedEvents.forEach((event, index) => {
                const contentType = event.eventData.content_type;
                const isValid = isValidContentType(contentType);
                
                if (isValid) {
                    validCount++;
                    log('validation-results', `‚úÖ Evento ${index + 1}: ${contentType} - V√ÅLIDO`, 'success');
                } else {
                    invalidCount++;
                    log('validation-results', `‚ùå Evento ${index + 1}: ${contentType} - INV√ÅLIDO`, 'error');
                }
            });
            
            log('validation-results', `\nResumo: ${validCount} v√°lidos, ${invalidCount} inv√°lidos`, 
                invalidCount === 0 ? 'success' : 'warning');
        }

        function showValidValues() {
            const validTypes = [
                'product - Produtos e servi√ßos',
                'product_group - Grupos de produtos',
                'website - Conte√∫do de website',
                'article - Artigos e blogs',
                'landing_page - P√°ginas de destino'
            ];
            
            log('validation-results', 'Valores v√°lidos para content_type:\n' + validTypes.join('\n'), 'info');
        }

        // Inicializar log
        updateEventLog();
        
        // Auto-executar alguns testes ap√≥s carregamento
        setTimeout(() => {
            log('test-results', 'Sistema carregado. Execute os testes para verificar as corre√ß√µes.', 'info');
        }, 1000);
    </script>
</body>
</html>
