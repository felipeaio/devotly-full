<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Fun√ß√µes TikTok Events - Create Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        .test-button:hover {
            background: #45a049;
        }
        .test-button.error {
            background: #f44336;
        }
        .test-button.success {
            background: #4CAF50;
        }
        .log {
            background: #f9f9f9;
            border-left: 5px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow: auto;
        }
        .success { border-left-color: #28a745; }
        .error { border-left-color: #dc3545; }
        .warning { border-left-color: #ffc107; }
        .function-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
    </style>
    <!-- TikTok Pixel Code Start -->
    <script>
    !function (w, d, t) {
      w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(
    var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script")
    ;n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};

      ttq.load('D1QFD0RC77UF6MBM48MG');
    }(window, document, 'ttq');
    </script>
    <!-- TikTok Pixel Code End -->
</head>
<body>
    <h1>üîß Teste de Fun√ß√µes TikTok Events - Create Page</h1>
    <p>Esta p√°gina testa todas as fun√ß√µes do TikTokEvents que s√£o usadas na p√°gina create.html:</p>

    <div class="test-section">
        <h2>1. Verifica√ß√£o de Disponibilidade das Fun√ß√µes</h2>
        <p>Verifica se todas as fun√ß√µes necess√°rias est√£o dispon√≠veis no objeto TikTokEvents:</p>
        <button class="test-button" id="checkFunctionsButton">Verificar Fun√ß√µes</button>
        <div id="functionsResult" class="log">Clique no bot√£o para verificar</div>
    </div>

    <div class="test-section">
        <h2>2. Teste de Fun√ß√µes B√°sicas</h2>
        <p>Testa as fun√ß√µes que estavam causando erros no create.js:</p>
        <div class="function-list">
            <button class="test-button" onclick="testFunction('trackClickButton')">trackClickButton</button>
            <button class="test-button" onclick="testFunction('trackViewContent')">trackViewContent</button>
            <button class="test-button" onclick="testFunction('viewCreateContent')">viewCreateContent</button>
            <button class="test-button" onclick="testFunction('selectPlan')">selectPlan</button>
            <button class="test-button" onclick="testFunction('startCheckout')">startCheckout</button>
            <button class="test-button" onclick="testFunction('addPaymentInfo')">addPaymentInfo</button>
            <button class="test-button" onclick="testFunction('startCardCreation')">startCardCreation</button>
            <button class="test-button" onclick="testFunction('identifyUser')">identifyUser</button>
        </div>
        <div id="functionTestResult" class="log">Clique em uma fun√ß√£o para test√°-la</div>
    </div>

    <div class="test-section">
        <h2>3. Teste do Sistema de Cria√ß√£o</h2>
        <p>Simula o fluxo de eventos da p√°gina create.html:</p>
        <div class="function-list">
            <button class="test-button" onclick="simulateCreateFlow()">Simular Fluxo de Cria√ß√£o</button>
            <button class="test-button" onclick="simulateVerseSelection()">Simular Sele√ß√£o de Vers√≠culo</button>
            <button class="test-button" onclick="simulateMusicSelection()">Simular Sele√ß√£o de M√∫sica</button>
            <button class="test-button" onclick="simulateCheckoutFlow()">Simular Fluxo de Checkout</button>
        </div>
        <div id="createFlowResult" class="log">Clique em um bot√£o para simular o fluxo</div>
    </div>

    <div class="test-section">
        <h2>4. Teste de Valida√ß√£o de Content Type</h2>
        <p>Testa se os content_types est√£o sendo validados corretamente:</p>
        <div class="function-list">
            <button class="test-button" onclick="testContentType('product')">product (v√°lido)</button>
            <button class="test-button" onclick="testContentType('invalid_type')">invalid_type (inv√°lido)</button>
            <button class="test-button" onclick="testContentType('form_step')">form_step (inv√°lido)</button>
            <button class="test-button" onclick="testContentType('page')">page (inv√°lido)</button>
        </div>
        <div id="contentTypeResult" class="log">Clique em um content_type para testar</div>
    </div>

    <script src="js/tiktok-events-optimized.js"></script>
    <script>
        let logDiv = null;

        function log(message, type = 'info') {
            if (logDiv) {
                const timestamp = new Date().toLocaleTimeString();
                logDiv.innerHTML += `[${timestamp}] ${message}\n`;
                logDiv.scrollTop = logDiv.scrollHeight;
                
                if (type === 'error') {
                    logDiv.className = 'log error';
                } else if (type === 'success') {
                    logDiv.className = 'log success';
                } else if (type === 'warning') {
                    logDiv.className = 'log warning';
                } else {
                    logDiv.className = 'log';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Aguardar um pouco para garantir que TikTokEvents esteja carregado
            setTimeout(() => {
                document.getElementById('checkFunctionsButton').addEventListener('click', checkFunctions);
            }, 1000);
        });

        function checkFunctions() {
            logDiv = document.getElementById('functionsResult');
            logDiv.innerHTML = 'Verificando fun√ß√µes dispon√≠veis...\n';

            const requiredFunctions = [
                'trackClickButton',
                'trackViewContent', 
                'viewCreateContent',
                'selectPlan',
                'startCheckout',
                'addPaymentInfo',
                'startCardCreation',
                'identifyUser',
                'forceDataDetection',
                'getCoverage',
                'viewCreatePage',
                'viewHomePage',
                'viewCard'
            ];

            let allAvailable = true;
            let availableCount = 0;

            log('=== VERIFICA√á√ÉO DE FUN√á√ïES ===');
            log(`TikTokEvents existe: ${typeof TikTokEvents !== 'undefined' ? '‚úÖ' : '‚ùå'}`);
            log(`window.TikTokEvents existe: ${typeof window.TikTokEvents !== 'undefined' ? '‚úÖ' : '‚ùå'}`);

            if (typeof TikTokEvents !== 'undefined' || typeof window.TikTokEvents !== 'undefined') {
                const tikTokObj = window.TikTokEvents || TikTokEvents;
                
                log('\n=== FUN√á√ïES PRINCIPAIS ===');
                requiredFunctions.forEach(funcName => {
                    const exists = typeof tikTokObj[funcName] === 'function';
                    log(`${funcName}: ${exists ? '‚úÖ' : '‚ùå'}`);
                    if (exists) availableCount++;
                    else allAvailable = false;
                });

                log('\n=== OBJETO CREATE ===');
                if (tikTokObj.create) {
                    const createFunctions = ['startCreation', 'fillStep', 'uploadImage', 'selectVerse', 'addMusic', 'previewCard', 'editCard', 'completeCreation', 'navigateSteps'];
                    createFunctions.forEach(funcName => {
                        const exists = typeof tikTokObj.create[funcName] === 'function';
                        log(`create.${funcName}: ${exists ? '‚úÖ' : '‚ùå'}`);
                        if (exists) availableCount++;
                        else allAvailable = false;
                    });
                } else {
                    log('create object: ‚ùå N√ÉO ENCONTRADO');
                    allAvailable = false;
                }

                log(`\n=== RESUMO ===`);
                log(`Fun√ß√µes dispon√≠veis: ${availableCount}/${requiredFunctions.length + 9}`);
                log(`Status: ${allAvailable ? '‚úÖ TODAS DISPON√çVEIS' : '‚ö†Ô∏è ALGUMAS FALTANDO'}`, allAvailable ? 'success' : 'warning');
            } else {
                log('‚ùå TikTokEvents n√£o encontrado!', 'error');
                allAvailable = false;
            }
        }

        function testFunction(funcName) {
            logDiv = document.getElementById('functionTestResult');
            logDiv.innerHTML = `Testando ${funcName}...\n`;

            try {
                const tikTokObj = window.TikTokEvents || TikTokEvents;
                
                if (!tikTokObj) {
                    log('‚ùå TikTokEvents n√£o encontrado!', 'error');
                    return;
                }

                if (typeof tikTokObj[funcName] !== 'function') {
                    log(`‚ùå Fun√ß√£o ${funcName} n√£o encontrada!`, 'error');
                    return;
                }

                log(`‚úÖ Fun√ß√£o ${funcName} encontrada, executando teste...`);

                // Executar teste espec√≠fico para cada fun√ß√£o
                switch(funcName) {
                    case 'trackClickButton':
                        tikTokObj.trackClickButton('Bot√£o Teste', 'test_button', 5);
                        log('‚úÖ trackClickButton executado com sucesso!', 'success');
                        break;
                    
                    case 'trackViewContent':
                        tikTokObj.trackViewContent('test_content', 'Conte√∫do Teste', 10, 'BRL', 'product', 'test_category');
                        log('‚úÖ trackViewContent executado com sucesso!', 'success');
                        break;

                    case 'viewCreateContent':
                        tikTokObj.viewCreateContent('test_type', 'Teste ViewCreateContent');
                        log('‚úÖ viewCreateContent executado com sucesso!', 'success');
                        break;

                    case 'selectPlan':
                        tikTokObj.selectPlan('plano_teste', 29.90);
                        log('‚úÖ selectPlan executado com sucesso!', 'success');
                        break;

                    case 'startCheckout':
                        tikTokObj.startCheckout('card_123', 'plano_teste', 29.90);
                        log('‚úÖ startCheckout executado com sucesso!', 'success');
                        break;

                    case 'addPaymentInfo':
                        tikTokObj.addPaymentInfo('plano_teste', 29.90);
                        log('‚úÖ addPaymentInfo executado com sucesso!', 'success');
                        break;

                    case 'startCardCreation':
                        tikTokObj.startCardCreation();
                        log('‚úÖ startCardCreation executado com sucesso!', 'success');
                        break;

                    case 'identifyUser':
                        tikTokObj.identifyUser('teste@example.com', '+5511999999999', 'user_123');
                        log('‚úÖ identifyUser executado com sucesso!', 'success');
                        break;

                    default:
                        const result = tikTokObj[funcName]();
                        log(`‚úÖ ${funcName} executado! Resultado: ${result}`, 'success');
                }

            } catch (error) {
                log(`‚ùå Erro ao testar ${funcName}: ${error.message}`, 'error');
                console.error(`Erro no teste de ${funcName}:`, error);
            }
        }

        function simulateCreateFlow() {
            logDiv = document.getElementById('createFlowResult');
            logDiv.innerHTML = 'Simulando fluxo de cria√ß√£o...\n';

            try {
                const tikTokObj = window.TikTokEvents || TikTokEvents;
                
                log('=== SIMULA√á√ÉO DO FLUXO DE CRIA√á√ÉO ===');
                
                // 1. Iniciar p√°gina de cria√ß√£o
                log('1. Iniciando p√°gina de cria√ß√£o...');
                tikTokObj.viewCreatePage();
                tikTokObj.create.startCreation();
                
                // 2. For√ßar detec√ß√£o de dados
                log('2. For√ßando detec√ß√£o de dados...');
                tikTokObj.forceDataDetection();
                
                // 3. Simular preenchimento de etapas
                log('3. Simulando preenchimento de etapas...');
                tikTokObj.create.fillStep(1, 'T√≠tulo do Cart√£o');
                tikTokObj.create.fillStep(2, 'Mensagem de F√©');
                tikTokObj.create.fillStep(3, 'Sele√ß√£o de Imagens');
                
                // 4. Simular upload de imagem
                log('4. Simulando upload de imagem...');
                tikTokObj.create.uploadImage();
                
                // 5. Simular preview
                log('5. Simulando preview do cart√£o...');
                tikTokObj.create.previewCard();
                
                // 6. Simular finaliza√ß√£o
                log('6. Simulando finaliza√ß√£o da cria√ß√£o...');
                tikTokObj.create.completeCreation('card_test_123');
                
                log('\n‚úÖ Fluxo de cria√ß√£o simulado com sucesso!', 'success');
                
                // Mostrar cobertura EMQ
                const coverage = tikTokObj.getCoverage();
                log(`\nüìä Cobertura EMQ: ${coverage.score}/100 pontos`);
                log(`Email: ${coverage.email ? '‚úÖ' : '‚ùå'} | Phone: ${coverage.phone ? '‚úÖ' : '‚ùå'} | TTCLID: ${coverage.ttclid ? '‚úÖ' : '‚ùå'}`);

            } catch (error) {
                log(`‚ùå Erro na simula√ß√£o: ${error.message}`, 'error');
                console.error('Erro na simula√ß√£o do fluxo:', error);
            }
        }

        function simulateVerseSelection() {
            logDiv = document.getElementById('createFlowResult');
            logDiv.innerHTML = 'Simulando sele√ß√£o de vers√≠culo...\n';

            try {
                const tikTokObj = window.TikTokEvents || TikTokEvents;
                
                log('=== SIMULA√á√ÉO DE SELE√á√ÉO DE VERS√çCULO ===');
                
                // Simular o que acontece no create.js linha 1000-1001
                log('Executando: TikTokEvents.create.selectVerse()');
                tikTokObj.create.selectVerse();
                
                log('Executando: TikTokEvents.trackClickButton()');
                tikTokObj.trackClickButton('Vers√≠culo Jo√£o 3:16', 'verse_selection', 5);
                
                log('‚úÖ Sele√ß√£o de vers√≠culo simulada com sucesso!', 'success');

            } catch (error) {
                log(`‚ùå Erro na simula√ß√£o de vers√≠culo: ${error.message}`, 'error');
                console.error('Erro na simula√ß√£o de vers√≠culo:', error);
            }
        }

        function simulateMusicSelection() {
            logDiv = document.getElementById('createFlowResult');
            logDiv.innerHTML = 'Simulando sele√ß√£o de m√∫sica...\n';

            try {
                const tikTokObj = window.TikTokEvents || TikTokEvents;
                
                log('=== SIMULA√á√ÉO DE SELE√á√ÉO DE M√öSICA ===');
                
                // Simular o que acontece no create.js linha 981-982
                log('Executando: TikTokEvents.create.addMusic()');
                tikTokObj.create.addMusic();
                
                log('Executando: TikTokEvents.trackClickButton()');
                tikTokObj.trackClickButton('M√∫sica Selecionada', 'music_selection', 5);
                
                log('‚úÖ Sele√ß√£o de m√∫sica simulada com sucesso!', 'success');

            } catch (error) {
                log(`‚ùå Erro na simula√ß√£o de m√∫sica: ${error.message}`, 'error');
                console.error('Erro na simula√ß√£o de m√∫sica:', error);
            }
        }

        function simulateCheckoutFlow() {
            logDiv = document.getElementById('createFlowResult');
            logDiv.innerHTML = 'Simulando fluxo de checkout...\n';

            try {
                const tikTokObj = window.TikTokEvents || TikTokEvents;
                
                log('=== SIMULA√á√ÉO DO FLUXO DE CHECKOUT ===');
                
                // Simular identifica√ß√£o de usu√°rio
                log('1. Identificando usu√°rio...');
                tikTokObj.identifyUser('teste@devotly.com', '+5511999887766', 'user_test_123');
                
                // Simular sele√ß√£o de plano
                log('2. Selecionando plano...');
                tikTokObj.selectPlan('Plano Anual', 59.90);
                
                // Simular in√≠cio do checkout
                log('3. Iniciando checkout...');
                tikTokObj.startCheckout('card_test_456', 'Plano Anual', 59.90);
                
                // Simular adi√ß√£o de informa√ß√µes de pagamento
                log('4. Adicionando informa√ß√µes de pagamento...');
                tikTokObj.addPaymentInfo('Plano Anual', 59.90);
                
                log('‚úÖ Fluxo de checkout simulado com sucesso!', 'success');

            } catch (error) {
                log(`‚ùå Erro na simula√ß√£o de checkout: ${error.message}`, 'error');
                console.error('Erro na simula√ß√£o de checkout:', error);
            }
        }

        function testContentType(contentType) {
            logDiv = document.getElementById('contentTypeResult');
            logDiv.innerHTML = `Testando content_type: ${contentType}...\n`;

            try {
                const tikTokObj = window.TikTokEvents || TikTokEvents;
                
                log(`=== TESTE DE CONTENT_TYPE: ${contentType} ===`);
                
                // Testar com trackViewContent
                log(`Executando trackViewContent com content_type: ${contentType}`);
                const result = tikTokObj.trackViewContent('test_content_' + Date.now(), 'Teste Content Type', 5, 'BRL', contentType, 'test_category');
                
                log(`Resultado: ${result ? '‚úÖ Sucesso' : '‚ö†Ô∏è Com avisos'}`, result ? 'success' : 'warning');
                log('Verifique o console do navegador para avisos de content_type inv√°lido.');

            } catch (error) {
                log(`‚ùå Erro no teste de content_type: ${error.message}`, 'error');
                console.error('Erro no teste de content_type:', error);
            }
        }

        // Interceptar console.warn para capturar avisos de content_type
        const originalWarn = console.warn;
        console.warn = function(...args) {
            if (args[0] && args[0].includes('content_type inv√°lido')) {
                if (logDiv && logDiv.id === 'contentTypeResult') {
                    log(`‚ö†Ô∏è ${args[0]}`, 'warning');
                }
            }
            originalWarn.apply(console, args);
        };
    </script>
</body>
</html>
