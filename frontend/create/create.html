<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devotly | Criar Cartão de Fé</title>
    <meta name="description" content="Crie lindos cartões digitais com mensagens de fé e versículos bíblicos">
    <!-- TikTok Pixel Code Start -->
<script>
!function (w, d, t) {
  w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(
var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script")
;n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};


  ttq.load('D1QFD0RC77UF6MBM48MG');
  // PageView com valor será disparado pelo TikTokEvents v3
  
  // Inicializar eventos personalizados quando o pixel carregar
  ttq.ready(function() {
    if (typeof initTikTokEvents === 'function') {
      initTikTokEvents();
      console.log('TikTok Events inicializado após carregamento do pixel');
    } else {
      console.warn('initTikTokEvents não está disponível. Verifique se tiktok-events.js está carregado.');
    }
  });
}(window, document, 'ttq');
</script>
<!-- TikTok Pixel Code End -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;500;600&display=swap" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,500;1,400&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/create.css">
    <link rel="stylesheet" href="../css/button-fixes.css">
    <link rel="stylesheet" href="../css/final-message-styles.css">
    <link rel="stylesheet" href="../css/preview-modal-fixes.css">    <link rel="stylesheet" href="../css/verse-suggestions-simple.css">
    <link rel="stylesheet" href="../css/verse-suggestions-responsive.css">
    <link rel="stylesheet" href="../css/media-responsive-fixes.css">
    <link rel="stylesheet" href="../css/plan-loading-overlay.css">

    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>

<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo">
                    <i class="fas fa-cross"></i>
                    <span>Devotly</span>
                </a>
            </div>
        </div>
    </header>
    <main class="creation-flow">
        <div class="container creation-layout">
            <section class="form-container">
                <!-- Versão reorganizada dos indicadores de progresso -->
                <div class="progress-header">
                    <div class="progress-container">
                        <div class="progress-bar-container">
                            <div class="progress-fill" id="progressBar"></div>
                        </div>
                        <div class="step-counter">
                            <span class="current">1</span>
                            <span class="separator">/</span>
                            <span class="total">8</span>
                        </div>
                    </div>
                </div>
                <form id="cardForm" class="creation-form">
                    <!-- Etapa 1: Nome da página -->
                    <div class="form-step active" data-step="1">
                        <div class="step-header">
                            <h2>Comece com um nome</h2>
                            <p>Escolha um nome único para seu cartão</p>
                        </div>
                        <div class="step-content">
                            <div class="input-group">
                                <label for="cardName">Nome do Cartão <span class="required-mark">*</span></label>
                                <input type="text" id="cardName" name="cardName" placeholder="ex: mensagem de fé"
                                    maxlength="20" required
                                    title="Letras, números, espaços e hífens são permitidos. Espaços serão convertidos em hífens automaticamente.">
                                <div class="input-hint">
                                    <i class="fas fa-link"></i>
                                    <span>Seu cartão estará em: <strong>devotly.com/<span
                                                id="urlPreview">seunome</span></strong></span>
                                </div>
                            </div>
                        </div>
                        <div class="step-actions">
                            <button type="button" class="btn btn-primary btn-next" data-next="2">
                                Próxima Etapa <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Etapa 2: Título da página -->
                    <div class="form-step" data-step="2">
                        <div class="step-header">
                            <h2>Adicione um título</h2>
                            <p>Escolha um título impactante para sua mensagem</p>
                        </div>
                        <div class="step-content">
                            <div class="input-group">
                                <label for="cardTitle">Título do Cartão <span class="required-mark">*</span></label>
                                <input type="text" id="cardTitle" name="cardTitle"
                                    placeholder="ex: Mensagem de Fé para Você" maxlength="60" minlength="3" required>
                                <div class="input-footer">
                                    <div class="char-counter">
                                        <span id="titleCounter">0</span>/60 caracteres
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="step-actions">
                            <button type="button" class="btn btn-secondary btn-prev" data-prev="1">
                                <i class="fas fa-arrow-left"></i> Voltar
                            </button>
                            <button type="button" class="btn btn-primary btn-next" data-next="3">
                                Próxima Etapa <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Etapa 3: Mensagem Principal -->
                    <div class="form-step" data-step="3">
                        <div class="step-header">
                            <h2>Crie sua mensagem</h2>
                            <p>Escreva uma mensagem inspiradora que toque corações</p>
                        </div>
                        <div class="step-content">
                            <div class="input-group">
                                <label for="cardMessage">Mensagem Principal <span class="required-mark">*</span></label>                                <textarea id="cardMessage" name="cardMessage" placeholder="Escreva sua mensagem aqui..."
                                    maxlength="350" required=""></textarea>
                                <div class="input-footer">
                                    <div class="char-counter">
                                        <span id="messageCounter">0</span>/350 caracteres
                                    </div>
                                </div>
                            </div>

                            <!-- Novo campo para mensagem final atualizado -->
                            <div class="input-group">
                                <label for="cardFinalMessage">Mensagem Final <span
                                        class="required-mark">*</span></label>
                                <textarea id="cardFinalMessage" name="cardFinalMessage"
                                    placeholder="Escreva uma mensagem de encerramento..." maxlength="100"
                                    required></textarea>
                                <div class="input-footer">
                                    <div class="char-counter">
                                        <span id="finalMessageCounter">0</span>/100 caracteres
                                    </div>
                                </div>
                                <div class="input-hint">
                                    <i class="fas fa-info-circle"></i>
                                    <span>Esta mensagem aparecerá no final do cartão como uma conclusão ou despedida
                                        (mínimo 5 caracteres)</span>
                                </div>
                            </div>
                        </div>
                        <div class="step-actions">
                            <button type="button" class="btn btn-secondary btn-prev" data-prev="2">
                                <i class="fas fa-arrow-left"></i> Voltar
                            </button>
                            <button type="button" class="btn btn-primary btn-next" data-next="4">
                                Próxima Etapa <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Etapa 4: Versículo -->
                    <!-- Etapa 4: Versículo Bíblico -->
                    <div class="form-step" data-step="4">
                        <div class="step-header">
                            <h2>Adicione um versículo</h2>
                            <p>Escolha um versículo bíblico para fortalecer sua mensagem</p>
                        </div>
                        <div class="step-content">
                            <div class="bible-selector">
                                <h3><i class="fas fa-book-bible"></i> Adicionar versículo</h3>
                                <div class="input-row">
                                    <div class="input-group">
                                        <label for="bibleBook">Livro</label>                                        <select id="bibleBook" name="bibleBook">
                                            <option value="">Selecione um livro</option>
                                            <option value="genesis">Gênesis</option>
                                            <option value="exodus">Êxodo</option>
                                            <option value="psalms">Salmos</option>
                                            <option value="proverbs">Provérbios</option>
                                            <option value="isaiah">Isaías</option>
                                            <option value="matthew">Mateus</option>
                                            <option value="john">João</option>
                                            <option value="romans">Romanos</option>
                                            <option value="corinthians1">1 Coríntios</option>
                                            <option value="philippians">Filipenses</option>
                                        </select>
                                    </div>
                                    <div class="input-group">
                                        <label for="bibleChapter">Capítulo</label>
                                        <input type="number" id="bibleChapter" name="bibleChapter" min="1"
                                            placeholder="ex: 23">
                                    </div>
                                    <div class="input-group">
                                        <label for="bibleVerse">Versículo</label>
                                        <input type="number" id="bibleVerse" name="bibleVerse" min="1"
                                            placeholder="ex: 1">
                                    </div>
                                </div>
                                <button type="button" id="fetchVerse" class="btn btn-secondary">
                                    <i class="fas fa-search"></i> Buscar Versículo
                                </button>
                                <div class="verse-preview" style="display: none;">
                                    <div class="verse-content">
                                        <div class="verse-quote">
                                            <i class="fas fa-quote-left"></i>
                                            <p class="verse-text"></p>
                                            <small class="verse-reference"></small>
                                        </div>
                                    </div>
                                </div>

                                <div class="verse-suggestions" aria-labelledby="verse-suggestions-title">
                                    <h4 id="verse-suggestions-title"><span>Versículos populares</span></h4>
                                    <div class="suggestion-list verse-list" role="list">
                                        <button type="button" class="suggestion-item verse-item" data-book="john"
                                            data-chapter="3" data-verse="16" aria-label="Selecionar João 3:16">
                                            <i class="fas fa-book-bible" aria-hidden="true"></i> João 3:16
                                        </button>
                                        <button type="button" class="suggestion-item verse-item" data-book="psalms"
                                            data-chapter="23" data-verse="1" aria-label="Selecionar Salmos 23:1">
                                            <i class="fas fa-book-bible" aria-hidden="true"></i> Salmos 23:1
                                        </button>
                                        <button type="button" class="suggestion-item verse-item" data-book="proverbs"
                                            data-chapter="3" data-verse="5" aria-label="Selecionar Provérbios 3:5">
                                            <i class="fas fa-book-bible" aria-hidden="true"></i> Provérbios 3:5
                                        </button>
                                        <button type="button" class="suggestion-item verse-item" data-book="isaiah"
                                            data-chapter="41" data-verse="10" aria-label="Selecionar Isaías 41:10">
                                            <i class="fas fa-book-bible" aria-hidden="true"></i> Isaías 41:10
                                        </button>
                                        <button type="button" class="suggestion-item verse-item" data-book="matthew"
                                            data-chapter="6" data-verse="33" aria-label="Selecionar Mateus 6:33">
                                            <i class="fas fa-book-bible" aria-hidden="true"></i> Mateus 6:33
                                        </button>
                                        <button type="button" class="suggestion-item verse-item" data-book="romans"
                                            data-chapter="8" data-verse="28" aria-label="Selecionar Romanos 8:28">
                                            <i class="fas fa-book-bible" aria-hidden="true"></i> Romanos 8:28
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="step-actions">
                            <button type="button" class="btn btn-secondary btn-prev" data-prev="3">
                                <i class="fas fa-arrow-left"></i> Voltar
                            </button>
                            <button type="button" class="btn btn-primary btn-next" data-next="5">
                                Próxima Etapa <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Etapa 5: Fotos -->
                    <div class="form-step" data-step="5">
                        <div class="step-header">
                            <h2>Adicione fotos</h2>
                            <p>Enriqueça seu cartão com imagens inspiradoras</p>
                        </div>
                        <div class="step-content">
                            <div class="media-section">
                                <h3><i class="fas fa-images"></i> Imagens</h3>
                                <input type="file" id="imageUpload" accept="image/jpeg,image/png,image/webp" multiple
                                    style="display: none;" data-handled="false">
                                <div class="upload-area" id="uploadArea">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <span>Arraste imagens aqui ou clique para selecionar</span>
                                    <small>Mínimo 1 imagem, máximo 5 imagens (2MB cada) <span
                                            class="required-mark">*</span></small>
                                </div>
                                <div class="image-preview-container" id="imagePreviewContainer"></div>
                            </div>
                        </div>
                        <div class="step-actions">
                            <button type="button" class="btn btn-secondary btn-prev" data-prev="4">
                                <i class="fas fa-arrow-left"></i> Voltar
                            </button>
                            <button type="button" class="btn btn-primary btn-next" data-next="6">
                                Próxima Etapa <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Etapa 6: Link do vídeo/música Spotify - Sem as sugestões musicais -->
                    <div class="form-step" data-step="6">
                        <div class="step-header">
                            <h2>Adicione música</h2>
                            <p>Inclua uma trilha sonora para sua mensagem</p>
                        </div>
                        <div class="step-content">
                            <div class="media-section">
                                <h3><i class="fas fa-music"></i> Música ou vídeo <span class="required-mark">*</span>
                                </h3>
                                <div class="input-group">
                                    <label for="musicLink">Link do YouTube ou Spotify <span
                                            class="required-mark">*</span></label>
                                    <input type="url" id="musicLink" name="musicLink" value=""
                                        placeholder="Cole aqui o link do YouTube ou Spotify" required>
                                    <div class="input-hint">
                                        <i class="fas fa-info-circle"></i>
                                        <span>Adicione um link direto para uma música ou vídeo inspirador</span>
                                    </div>
                                </div>
                                <!-- Elementos de sugestões de música removidos -->
                            </div>
                        </div>
                        <div class="step-actions">
                            <button type="button" class="btn btn-secondary btn-prev" data-prev="5">
                                <i class="fas fa-arrow-left"></i> Voltar
                            </button>
                            <button type="button" class="btn btn-primary btn-next" data-next="7">
                                Próxima Etapa <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Etapa 7: Email - Remover o checkbox de newsletter -->
                    <div class="form-step" data-step="7">
                        <div class="step-header">
                            <h2>Seus dados de contato</h2>
                            <p>Para enviarmos seu cartão e confirmações</p>
                        </div>
                        <div class="step-content">
                            <div class="input-group">
                                <label for="userEmail">Email <span class="required-mark">*</span></label>
                                <input type="email" id="userEmail" name="userEmail" placeholder="seuemail@exemplo.com" maxlength="30" required
                                    required>
                                <div class="input-hint">
                                    <i class="fas fa-shield-alt"></i>
                                    <span>Usamos seu email apenas para enviar confirmações e o link do seu cartão</span>
                                </div>
                            </div>                            <div class="input-group">
                                <label for="userName">Seu nome <span class="required-mark">*</span></label>
                                <input type="text" id="userName" name="userName" placeholder="Como podemos te chamar?" maxlength="25" required>
                            </div>

                            <div class="input-group">
                                <label for="userPhone">Telefone (WhatsApp)</label>
                                <input type="tel" id="userPhone" name="userPhone" placeholder="(99) 99999-9999"
                                    required>
                                <div class="input-hint">
                                    <i class="fas fa-phone"></i>
                                    <span>Usamos seu telefone para enviar confirmações e para contato de suporte</span>
                                </div>
                            </div>

                            <div class="form-check">
                                <input type="checkbox" id="acceptTerms" name="acceptTerms" required>
                                <label for="acceptTerms">
                                    Li e aceito os <a href="https://devotly.shop/termos" target="_blank" rel="noopener noreferrer">Termos de Uso</a> 
                                    e <a href="https://devotly.shop/privacidade" target="_blank" rel="noopener noreferrer">Política de Privacidade</a>
                                </label>
                            </div>
                        </div>
                        <div class="step-actions">
                            <button type="button" class="btn btn-secondary btn-prev" data-prev="6">
                                <i class="fas fa-arrow-left"></i> Voltar
                            </button>
                            <button type="button" class="btn btn-primary btn-next" data-next="8">
                                Próxima Etapa <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Etapa 8: Escolha do plano -->
                    <div class="form-step" data-step="8">
                        <div class="step-header">
                            <h2><i class="fas fa-credit-card"></i> Escolha seu Plano</h2>
                            <p>Selecione um plano para finalizar seu cartão</p>
                        </div>
                        <div class="step-content">
                            <div class="plan-cards" aria-labelledby="payment-label">
                                <div class="plan-card featured" data-plan="forever">
                                    <div class="plan-badge">Mais escolhido</div>
                                    <div class="plan-header">
                                        <h3>Para sempre</h3>
                                        <div class="plan-price">
                                            <span class="original-price">R$ 34,00</span>
                                            <span class="discount-price">R$ 17,99</span>
                                            <span class="price-period">/uma vez</span>
                                        </div>
                                    </div>
                                    <div class="plan-features">
                                        <ul>
                                            <li><i class="fas fa-check"></i>Texto dedicado</li>
                                            <li><i class="fas fa-check"></i>QR Code exclusivo</li>
                                            <li><i class="fas fa-check"></i>5 imagens</li>
                                            <li><i class="fas fa-check"></i>Com música</li>
                                            <li><i class="fas fa-check"></i>URL personalizada</li>
                                            <li><i class="fas fa-check"></i>Suporte 24h</li>
                                        </ul>
                                    </div>
                                    <button type="button" class="btn btn-primary btn-select-plan" data-plan="forever">
                                        Selecionar plano
                                    </button>
                                </div>

                                <div class="plan-card" data-plan="annual">
                                    <div class="plan-header">
                                        <h3>Anual</h3>
                                        <div class="plan-price">
                                            <span class="original-price">R$ 24,00</span>
                                            <span class="discount-price">R$ 8,99</span>
                                            <span class="price-period">/por ano</span>
                                        </div>
                                    </div>
                                    <div class="plan-features">
                                        <ul>
                                            <li><i class="fas fa-check"></i>Texto dedicado</li>
                                            <li><i class="fas fa-check"></i>QR Code exclusivo</li>
                                            <li><i class="fas fa-check"></i>3 imagens</li>
                                            <li><i class="fas fa-times"></i>Sem música</li>
                                            <li><i class="fas fa-check"></i>URL personalizada</li>
                                            <li><i class="fas fa-check"></i>Suporte 24h</li>
                                        </ul>
                                    </div>
                                    <button type="button" class="btn btn-primary btn-select-plan" data-plan="annual">
                                        Selecionar plano
                                    </button>
                                </div>
                            </div>
                        </div>
                        <!-- Etapa 8: Escolha do plano - Ações modificadas -->
                        <div class="step-actions">
                            <button type="button" class="btn btn-secondary btn-prev" data-prev="7">
                                <i class="fas fa-arrow-left"></i> Voltar
                            </button>
                            <!-- Botão de finalizar removido -->
                        </div>
                    </div>
                </form>
                <!-- Move the preview button here, after the form -->
                <button type="button" id="previewButton" class="btn-preview">
                    <i class="fas fa-eye"></i> PRÉ-VISUALIZAR
                </button>
            </section>
            <aside class="card-preview-container">
                <div class="card-preview">
                    <div class="preview-theme" id="previewTheme">
                        <div class="preview-sections" style="height: 100%; overflow: hidden;">
                            <!-- Seção 1: Título -->
                            <section class="preview-section" id="titleSection">
                                <div class="section-content title-container">
                                    <div class="title-wrapper">
                                        <h1 id="cardTitle" class="card-title">Mensagem de Fé para Você</h1>
                                        <div class="title-decorators">
                                            <span class="decorator-line left"></span>
                                            <span class="decorator-icon"><i class="fas fa-cross"></i></span>
                                            <span class="decorator-line right"></span>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Seção 2: Mensagem -->
                            <section class="preview-section" id="messageSection">
                                <div class="section-content">
                                    <div class="message-container">
                                        <p id="cardMessage">Sua mensagem aparecerá aqui...</p>
                                    </div>
                                </div>
                            </section>

                            <!-- Seção 3: Versículo -->
                            <section class="preview-section" id="verseSection">
                                <div class="section-content">
                                    <div class="verse-container">
                                        <div class="verse-content">
                                            <i class="fas fa-quote-left quote-icon"></i>
                                            <p id="verseText">Porque Deus amou o mundo de tal maneira...</p>
                                            <span id="verseRef">João 3:16</span>
                                        </div>
                                        <div class="verse-decoration bottom">
                                            <span class="decoration-line"></span>
                                            <i class="fas fa-cross"></i>
                                            <span class="decoration-line"></span>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Seção 4: Galeria -->
                            <section class="preview-section" id="gallerySection">
                                <div class="section-content">
                                    <div class="gallery-container">
                                        <div class="gallery-inner">
                                            <!-- As imagens serão inseridas aqui dinamicamente -->
                                        </div>
                                        <div class="carousel-controls">
                                            <button class="carousel-prev" aria-label="Anterior">
                                                <i class="fas fa-chevron-left"></i>
                                            </button>
                                            <button class="carousel-next" aria-label="Próximo">
                                                <i class="fas fa-chevron-right"></i>
                                            </button>
                                        </div>
                                        <!-- Indicadores e contador aqui, se necessário -->
                                    </div>
                                </div>
                            </section>

                            <!-- Seção 5: Mídia -->
                            <section class="preview-section" id="mediaSection">
                                <div class="section-content">
                                    <div class="media-container" id="cardMedia">
                                        <!-- Mídia será inserida via JavaScript -->
                                    </div>
                                </div>
                            </section>

                            <!-- Seção 6: Mensagem Final - Versão igual à página view -->
                            <section class="preview-section" id="finalSection">
                                <div class="section-content final-section-content">
                                    <!-- Mensagem Final -->
                                    <div class="final-message">
                                        <p id="previewFinalMessage">Que esta mensagem toque seu coração</p>
                                        <div class="message-decoration">
                                            <i class="fas fa-cross"></i>
                                        </div>
                                        <div class="card-author" id="previewCardAuthor">De: Seu Nome</div>
                                    </div>
                                </div>
                            </section>
                        </div>
                        <!-- Modificar os section-dot para incluir labels -->
                        <div class="section-indicators">
                            <div class="section-dot active" data-section="titleSection" data-label="Título"></div>
                            <div class="section-dot" data-section="messageSection" data-label="Mensagem"></div>
                            <div class="section-dot" data-section="verseSection" data-label="Versículo"></div>
                            <div class="section-dot" data-section="gallerySection" data-label="Galeria"></div>
                            <div class="section-dot" data-section="mediaSection" data-label="Mídia"></div>
                            <div class="section-dot" data-section="finalSection" data-label="Final"></div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </main>
    <div class="modal-overlay" id="loadingModal">
        <div class="modal-content">
            <div class="spinner">
                <div class="spinner-circle"></div>
            </div>
            <h3>Processando pagamento...</h3>
            <p>Isso pode levar alguns instantes</p>
        </div>
    </div>
    <div class="modal-overlay" id="successModal">
        <div class="modal-content">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3>Cartão criado com sucesso!</h3>
            <p>Seu cartão digital está pronto para ser compartilhado</p>
            <div class="modal-actions">
                <button id="viewCardBtn" class="btn btn-primary">
                    <i class="fas fa-external-link-alt"></i> Ver Cartão
                </button>
                <button id="copyCardLinkBtn" class="btn btn-secondary">
                    <i class="fas fa-copy"></i> Copiar Link
                </button>
            </div>
        </div>
    </div>

    <!-- Add before the closing -->
    <div id="previewModal" class="preview-modal">
        <div class="preview-modal-content">
            <div class="preview-modal-body"></div>
            <button type="button" id="closePreviewButton" class="btn-close-preview">
                <i class="fas fa-arrow-left"></i> VOLTAR
            </button>
        </div>
    </div>

    <!-- Scripts do sistema -->
    <script src="../js/core/MediaHandler.js"></script>
    <script src="../js/core/error-handler.js"></script>
    <script src="../js/tiktok-events-v3.js"></script>
    <script src="../js/tiktok-multi-pixel.js"></script>
    <script src="../js/purchase-tracker.js"></script>
    <script src="../js/create-viewcontent-tracker.js"></script>
    <script src="../js/create.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/intersection-observer@0.12.2/intersection-observer.min.js"></script>
    <script>
        // Função global para testar InitiateCheckout manualmente
        window.testInitiateCheckout = function(planType = 'para_sempre') {
            console.log('🧪 TESTE MANUAL: Testando InitiateCheckout para', planType);
            const planValues = { 'para_sempre': 17.99, 'anual': 8.99 };
            const value = planValues[planType];
            const cardId = 'test-card-' + Date.now();
            
            if (typeof TikTokEvents !== 'undefined' && TikTokEvents.startCheckout) {
                TikTokEvents.startCheckout(cardId, planType, value);
                console.log('✅ TESTE: InitiateCheckout disparado!');
            } else {
                console.error('❌ TESTE: TikTokEvents não encontrado!');
            }
        };
        
        // Função para testar AddPaymentInfo
        window.testAddPaymentInfo = function(planType = 'para_sempre') {
            console.log('🧪 TESTE MANUAL: Testando AddPaymentInfo para', planType);
            const planValues = { 'para_sempre': 17.99, 'anual': 8.99 };
            const value = planValues[planType];
            
            if (typeof TikTokEvents !== 'undefined' && TikTokEvents.addPaymentInfo) {
                TikTokEvents.addPaymentInfo(planType, value);
                console.log('✅ TESTE: AddPaymentInfo disparado!');
            } else {
                console.error('❌ TESTE: TikTokEvents.addPaymentInfo não encontrado!');
            }
        };
        
        // Monitorar cliques nos botões de seleção de plano
        document.addEventListener('DOMContentLoaded', function() {
            // Aguardar um pouco para garantir que tudo carregou
            setTimeout(() => {
                const planButtons = document.querySelectorAll('.btn-select-plan');
                console.log(`🔍 MONITORANDO: ${planButtons.length} botões de seleção de plano encontrados`);
                
                planButtons.forEach((button, index) => {
                    const planType = button.dataset.plan;
                    console.log(`📌 Botão ${index + 1}: data-plan="${planType}"`);
                    
                    // Adicionar listener de debug
                    button.addEventListener('click', function(e) {
                        console.log(`🎯 CLIQUE DETECTADO no botão: data-plan="${planType}"`);
                        console.log('📍 Elemento clicado:', button);
                    });
                });
                
                // Verificar se TikTokEvents está disponível
                if (typeof TikTokEvents !== 'undefined') {
                    console.log('✅ TikTokEvents disponível');
                    console.log('🔧 Métodos disponíveis:', Object.keys(TikTokEvents));
                } else {
                    console.error('❌ TikTokEvents não encontrado');
                }
            }, 1000);
        });
    </script>

    <!-- Purchase Detection Script -->
    <script>
    // Script para detectar Purchase events na página create
    document.addEventListener('DOMContentLoaded', function() {
        // Função para detectar retorno de pagamento aprovado
        function checkForPurchaseSuccess() {
            const urlParams = new URLSearchParams(window.location.search);
            const status = urlParams.get('status') || urlParams.get('collection_status');
            const paymentId = urlParams.get('payment_id');
            const paymentType = urlParams.get('payment_type');
            
            // Verificar se é um retorno de pagamento aprovado
            if (status === 'approved' && paymentId) {
                console.log('✅ Purchase Success: Pagamento aprovado detectado na página create');
                
                // Recuperar dados armazenados
                const paymentData = JSON.parse(localStorage.getItem('devotlyPaymentData') || '{}');
                const cardData = JSON.parse(localStorage.getItem('devotlyCardData') || '{}');
                const userData = JSON.parse(localStorage.getItem('devotlyUserData') || '{}');
                
                // Valores dos planos
                const planValues = { 
                    'para_sempre': 17.99, 
                    'anual': 8.99,
                    'Para Sempre': 17.99,
                    'Anual': 8.99
                };
                
                const planType = paymentData.planType || cardData.planName || 'para_sempre';
                const value = paymentData.value || cardData.price || planValues[planType] || 17.99;
                const cardId = paymentData.cardId || cardData.id || paymentId;
                
                // Aguardar TikTok Events estar disponível
                function waitForTikTokAndFire() {
                    if (typeof TikTokEvents !== 'undefined') {
                        // Identificar usuário
                        const email = userData.email || paymentData.userEmail;
                        const phone = userData.phone || paymentData.userPhone;
                        
                        if (email || phone) {
                            const userId = email ? `purchase_${btoa(email).substr(0, 12)}_${Date.now()}` : null;
                            TikTokEvents.identifyUser(email, phone, userId);
                            console.log('🔍 TikTok: Usuário identificado para Purchase');
                        }
                        
                        // Disparar Purchase event
                        TikTokEvents.trackPurchase(
                            cardId,
                            `Plano Devotly ${planType}`,
                            value,
                            'BRL'
                        );
                        
                        console.log('🎯 TikTok Purchase disparado:', {
                            cardId: cardId,
                            planType: planType,
                            value: value,
                            currency: 'BRL'
                        });
                        
                        // Marcar como processado para evitar duplicatas
                        localStorage.setItem('devotly_purchase_processed', paymentId);
                        
                    } else {
                        // Tentar novamente em 500ms
                        setTimeout(waitForTikTokAndFire, 500);
                    }
                }
                
                // Verificar se já foi processado
                const alreadyProcessed = localStorage.getItem('devotly_purchase_processed');
                if (alreadyProcessed !== paymentId) {
                    waitForTikTokAndFire();
                } else {
                    console.log('⚠️ Purchase já processado para este payment_id:', paymentId);
                }
            }
        }
        
        // Verificar imediatamente
        checkForPurchaseSuccess();
        
        // Também verificar quando a URL muda (SPA behavior)
        let lastUrl = window.location.href;
        setInterval(() => {
            const currentUrl = window.location.href;
            if (currentUrl !== lastUrl) {
                lastUrl = currentUrl;
                setTimeout(checkForPurchaseSuccess, 100);
            }
        }, 1000);
        
        // Escutar mudanças no localStorage (caso dados sejam atualizados)
        window.addEventListener('storage', function(e) {
            if (e.key === 'devotlyPaymentData' && e.newValue) {
                setTimeout(checkForPurchaseSuccess, 100);
            }
        });
        
        // Escutar mensagens de popup/iframe de pagamento
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'payment_success') {
                console.log('✅ Mensagem de pagamento recebida:', event.data);
                setTimeout(checkForPurchaseSuccess, 100);
            }
        });
    });
    </script>

    <script>
        // Solução robusta para o problema do 'undefined'
        document.addEventListener('DOMContentLoaded', function () {
            // Função para limpar o campo musicLink
            function clearMusicLinkField() {
                const musicLinkInput = document.getElementById('musicLink');
                if (musicLinkInput) {
                    // Limpar o valor diretamente se for 'undefined' ou começar com 'undefined'
                    if (musicLinkInput.value === 'undefined' ||
                        musicLinkInput.value.indexOf('undefined') === 0 ||
                        musicLinkInput.value === 'null') {
                        musicLinkInput.value = '';
                    }
                }
            }

            // Limpar imediatamente
            clearMusicLinkField();

            // Limpar também quando o formulário for carregado completamente
            setTimeout(clearMusicLinkField, 500);

            // Limpar quando a etapa 6 estiver visível
            document.addEventListener('click', function (e) {
                if (e.target && e.target.classList.contains('btn-next')) {
                    if (e.target.dataset.next === '6') {
                        setTimeout(clearMusicLinkField, 100);
                    }
                }
            });

            // Observar mudanças no DOM para etapa 6
            const observer = new MutationObserver(function (mutations) {
                mutations.forEach(function (mutation) {
                    if (mutation.type === 'attributes' || mutation.type === 'childList') {
                        const step6 = document.querySelector('.form-step[data-step="6"]');
                        if (step6 && step6.classList.contains('active')) {
                            clearMusicLinkField();
                        }
                    }
                });
            });

            // Configurar observador
            const config = { attributes: true, childList: true, subtree: true };
            observer.observe(document.body, config);
        });
    </script>    <!-- Loading overlay para processamento de pagamento -->
    <div id="planLoadingOverlay" class="plan-loading-wrapper" style="display: none;">
        <div class="plan-loading-backdrop"></div>
        <div class="plan-loading-container">
            <div class="plan-loading-icon">
                <i class="fas fa-credit-card"></i>
            </div>
            <div class="plan-loading-spinner-wrapper">
                <div class="plan-loading-spinner"></div>
                <div class="plan-loading-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            <div class="plan-loading-content">
                <div class="plan-loading-text">Processando pagamento</div>
                <div class="plan-loading-subtext">Aguarde um momento...</div>
            </div>
            <div class="plan-loading-progress">
                <div class="plan-loading-progress-bar"></div>
                <div class="plan-loading-progress-text">0%</div>
            </div>
            <div class="plan-loading-security">
                <i class="fas fa-shield-alt"></i>
                <span>Processamento seguro</span>
            </div>
        </div>
    </div>


</body>

</html>