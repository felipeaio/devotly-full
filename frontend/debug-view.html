<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - View.html | Devotly</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/view.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <style>
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            max-width: 300px;
            font-family: monospace;
            font-size: 12px;
            z-index: 9999;
        }
        .debug-logs {
            max-height: 200px;
            overflow-y: auto;
            border-top: 1px solid #333;
            padding-top: 10px;
            margin-top: 10px;
        }
        .debug-log {
            margin-bottom: 5px;
            word-break: break-word;
        }
        .debug-success { color: #4CAF50; }
        .debug-error { color: #f44336; }
        .debug-warning { color: #ff9800; }
        .debug-info { color: #2196F3; }
    </style>
</head>
<body>
    <!-- Debug Panel -->
    <div class="debug-panel">
        <h4>üîç Debug Panel</h4>
        <div>Estado: <span id="debugState">Carregando...</span></div>
        <div>URL: <span id="debugUrl">-</span></div>
        <div>Card ID: <span id="debugCardId">-</span></div>
        <button onclick="clearDebugLogs()" style="margin-top: 10px;">Limpar Logs</button>
        <div class="debug-logs" id="debugLogs"></div>
    </div>

    <!-- Loading State -->
    <div id="loadingState" class="state-container loading-state active">
        <div class="loading-content">
            <div class="loading-icon">
                <div class="devotly-icon pulse"></div>
            </div>
            <h2>Carregando sua mensagem de f√©...</h2>
            <div class="loading-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </div>

    <!-- Error State -->
    <div id="errorState" class="state-container error-state">
        <div class="error-content">
            <div class="error-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h2>Cart√£o n√£o encontrado</h2>
            <p>Este link n√£o est√° mais dispon√≠vel ou pode ter expirado.</p>
            <a href="index.html" class="btn btn-primary">
                <i class="fas fa-arrow-left"></i>
                Voltar ao in√≠cio
            </a>
        </div>
    </div>

    <!-- Main Card Content -->
    <div id="cardContent" class="state-container card-content">
        <!-- Header -->
        <header class="card-header">
            <h1 id="cardTitle">Mensagem de F√©</h1>
            <p id="cardAuthor" class="card-author"></p>
        </header>

        <!-- Preview Sections -->
        <div id="previewSections" class="preview-sections">
            <!-- Message Section -->
            <section id="messageSection" class="preview-section active" data-section="message">
                <div class="section-content">
                    <div class="message-container">
                        <p id="cardMessage" class="card-message"></p>
                    </div>
                </div>
            </section>

            <!-- Gallery Section -->
            <section id="gallerySection" class="preview-section" data-section="gallery">
                <div class="section-content">
                    <div class="gallery-container">
                        <div id="galleryInner" class="gallery-inner"></div>
                        <div class="gallery-nav">
                            <button class="gallery-prev" onclick="viewer.navigateCarousel(-1)">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="gallery-next" onclick="viewer.navigateCarousel(1)">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Verse Section -->
            <section id="verseSection" class="preview-section" data-section="verse" style="display: none;">
                <div class="section-content">
                    <div class="verse-container">
                        <blockquote id="verseText" class="verse-text"></blockquote>
                        <cite id="verseRef" class="verse-reference"></cite>
                    </div>
                </div>
            </section>

            <!-- Media Section -->
            <section id="mediaSection" class="preview-section" data-section="media">
                <div class="section-content">
                    <div id="cardMedia" class="media-container"></div>
                </div>
            </section>

            <!-- Final Message Section -->
            <section id="finalSection" class="preview-section" data-section="final">
                <div class="section-content">
                    <div class="final-message-container">
                        <p id="finalMessage" class="final-message"></p>
                    </div>
                </div>
            </section>
        </div>

        <!-- Section Navigation -->
        <div class="section-navigation">
            <div class="section-dots" id="sectionDots"></div>
        </div>

        <!-- QR Code (Hidden) -->
        <img id="qrCodeImage" style="display: none;" />
    </div>

    <script>
        // Interceptar console.log para mostrar no debug panel
        const originalConsoleLog = console.log;
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            
            // Adicionar ao debug panel
            const message = args.join(' ');
            addDebugLog(message);
        };

        function addDebugLog(message) {
            const debugLogs = document.getElementById('debugLogs');
            const logDiv = document.createElement('div');
            logDiv.className = 'debug-log';
            
            // Colorir baseado no tipo de log
            if (message.includes('‚úÖ')) {
                logDiv.className += ' debug-success';
            } else if (message.includes('‚ùå')) {
                logDiv.className += ' debug-error';
            } else if (message.includes('‚ö†Ô∏è')) {
                logDiv.className += ' debug-warning';
            } else if (message.includes('‚ÑπÔ∏è')) {
                logDiv.className += ' debug-info';
            }
            
            logDiv.textContent = new Date().toLocaleTimeString() + ': ' + message;
            debugLogs.appendChild(logDiv);
            debugLogs.scrollTop = debugLogs.scrollHeight;
        }

        function clearDebugLogs() {
            document.getElementById('debugLogs').innerHTML = '';
        }

        // Atualizar informa√ß√µes do debug
        function updateDebugInfo() {
            document.getElementById('debugUrl').textContent = window.location.href;
            const urlParams = new URLSearchParams(window.location.search);
            const cardId = urlParams.get('id');
            document.getElementById('debugCardId').textContent = cardId || 'Nenhum';
        }

        // Usar um card ID real para teste
        const testCardId = '6c0d17a8-3af3-428b-b0f7-52e059d0a0d8'; // ID real encontrado no banco
        const testUrl = new URL(window.location);
        testUrl.searchParams.set('id', testCardId);
        window.history.replaceState({}, '', testUrl);

        updateDebugInfo();
        
        console.log('üöÄ Debug View inicializado!');
        console.log('üìç URL atual:', window.location.href);
        console.log('üÜî Card ID de teste:', testCardId);
        
        document.getElementById('debugState').textContent = 'Inicializado';
    </script>

    <!-- Scripts -->
    <script type="module" src="js/core/api-config.js"></script>
    <script type="module" src="js/view.js"></script>
    
    <script type="module">
        console.log('üì¶ Carregando m√≥dulos...');
        
        // Aguardar carregamento dos m√≥dulos
        setTimeout(() => {
            if (window.viewer) {
                console.log('‚úÖ DevotlyViewer carregado com sucesso!');
                document.getElementById('debugState').textContent = 'Pronto';
            } else {
                console.log('‚ùå DevotlyViewer n√£o foi carregado!');
                document.getElementById('debugState').textContent = 'Erro';
            }
        }, 1000);
    </script>
</body>
</html>
